<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <title>Teste do Backend Auth</title>
        <style>
            body {
                font-family: sans-serif;
                max-width: 600px;
                margin: 40px auto;
            }
            input {
                display: block;
                margin-bottom: 10px;
                padding: 8px;
                width: 100%;
            }
            button {
                padding: 10px 16px;
                margin-right: 10px;
            }
            .box {
                margin-top: 20px;
                padding: 15px;
                background: #eee;
                border-radius: 8px;
            }
        </style>
    </head>
    <body>
        <h1>Testar Backend JWT</h1>

        <h2>Register</h2>
        <input id="reg-username" placeholder="username" />
        <input id="reg-password" type="password" placeholder="password" />
        <button onclick="register()">Registrar</button>

        <h2>Login</h2>
        <input id="log-username" placeholder="username" />
        <input id="log-password" type="password" placeholder="password" />
        <button onclick="login()">Login</button>

        <h2>Auth Actions</h2>
        <button onclick="refreshToken()">Refresh Token</button>
        <button onclick="logout()">Logout</button>

        <div class="box">
            <h3>Access Token</h3>
            <pre id="access-token"></pre>
        </div>

        <div class="box">
            <h3>Response</h3>
            <pre id="response"></pre>
        </div>

        <script>
            const API_URL = "http://localhost:3333/api/auth"; // ajuste se necess√°rio
            let accessToken = null;

            function showResponse(data) {
                document.getElementById("response").textContent =
                    JSON.stringify(data, null, 2);
            }

            function updateAccessToken(token) {
                accessToken = token;
                document.getElementById("access-token").textContent =
                    token || "Nenhum token";
            }

            async function register() {
                const username = document.getElementById("reg-username").value;
                const password = document.getElementById("reg-password").value;

                const res = await fetch(API_URL + "/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, password }),
                });

                const data = await res.json();
                showResponse(data);
            }

            async function login() {
                const username = document.getElementById("log-username").value;
                const password = document.getElementById("log-password").value;

                const res = await fetch(API_URL + "/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, password }),
                });

                const data = await res.json();
                showResponse(data);

                if (data.accessToken) updateAccessToken(data.accessToken);
            }

            async function refreshToken() {
                const res = await fetch(API_URL + "/refresh", {
                    method: "POST",
                });

                const data = await res.json();
                showResponse(data);

                if (data.accessToken) updateAccessToken(data.accessToken);
            }

            async function logout() {
                const res = await fetch(API_URL + "/logout", {
                    method: "POST",
                });

                showResponse("Logout feito.");
                updateAccessToken(null);
            }
        </script>
    </body>
</html>
